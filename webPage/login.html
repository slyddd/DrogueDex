<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Droguedex</title>
  <link rel="stylesheet" href="./styles/styles.css">
  <link rel="stylesheet" href="styles/globals.css">
</head>
<body>
  <div class="container">
    <div class="form-section">
      <form id="registerForm" action="https://cienciadatos701.dcramirez.com/G2/api/auth/register/" method="POST">
        <input id="nombre" type="text" name="nombre" placeholder="Nombre" class="input-field" required>
        <input id="apellido" type="text" name="apellido" placeholder="Apellido" class="input-field" required>
        <input id="correo" type="email" name="correo" placeholder="Correo" class="input-field" required>
        <input id="contraseña" type="password" name="contraseña" placeholder="Contraseña" class="input-field" required>
        
        <select id="id_rol" name="rol" class="input-field" required>
          <option value="" disabled selected>Seleccione un rol</option>
          <option value="Administrador">Administrador</option>
          <option value="Usuario">Usuario</option>
          <option value="Medico">Medico</option>
          <option value="Paciente">Paciente</option>
        </select>
      
        <button class="btn" type="submit">Crear Cuenta</button>
      </form>
    </div>
    <div class="logo-section">
      <img src="assets/logo.png" alt="Droguedex" class="logo">
      <h1 class="logo-text">Droguedex</h1>
    </div>
  </div>

  <script>
    document.getElementById('registerForm').addEventListener('submit', async function (e) {
      e.preventDefault(); // Evitar que el formulario se envíe de manera tradicional

      // Validación de campos
      const nombre = document.getElementById('nombre').value.trim();
      const apellido = document.getElementById('apellido').value.trim();
      const correo = document.getElementById('correo').value.trim();
      const contraseña = document.getElementById('contraseña').value.trim();
      const rol = document.getElementById('id_rol').value;

      // Verificar que todos los campos estén llenos
      if (!nombre || !apellido || !correo || !contraseña || !rol) {
        alert("Por favor, complete todos los campos.");
        return; // No enviar el formulario si hay campos vacíos
      }

      // Deshabilitar el botón de enviar mientras se procesa
      const submitButton = this.querySelector('button[type="submit"]');
      submitButton.disabled = true;
      submitButton.textContent = 'Registrando...';

      try {
        const formData = new FormData(this); // Capturar los datos del formulario
        const response = await fetch('https://cienciadatos701.dcramirez.com/G2/api/auth/register/', {
          method: 'POST',
          body: formData
        });

        const result = await response.json(); // Procesar la respuesta del backend

        if (result.status === 200) {
          alert(result.status || 'Usuario registrado exitosamente.');
          // window.location.href = 'welcome.html'; // Redirigir a welcome.html si el registro fue exitoso
        } else {
          alert(result.response + " " + JSON.stringify(FormData) || 'Ocurrió un error al registrar el usuario.');
        }
      } catch (error) {
        alert('Error de red: ' + error.message); // Manejar errores de red
      } finally {
        submitButton.disabled = false; // Habilitar el botón nuevamente
        submitButton.textContent = 'Crear Cuenta';
      }
    });
  </script>
</body>
</html>
