<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Droguedex - Registro</title>
  <link rel="stylesheet" href="./styles/styles.css">
  <link rel="stylesheet" href="./styles/globals.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script> <!-- SweetAlert2 -->
</head>
<body>
  <div class="container">
    <div class="form-section">
      <form id="registerForm">
        <input id="nombre" type="text" name="nombre" placeholder="Nombre" class="input-field" required>
        <input id="apellido" type="text" name="apellido" placeholder="Apellido" class="input-field" required>
        <input id="correo" type="email" name="correo" placeholder="Correo" class="input-field" required>
        <input id="contraseña" type="password" name="contraseña" placeholder="Contraseña (mínimo 6 caracteres)" class="input-field" minlength="6" required>
        
        <select id="id_rol" name="id_rol" class="input-field" required>
          <option value="" disabled selected>Seleccione un rol</option>
          <option value="Administrador">Administrador</option>
          <option value="Medico">Médico</option>
          <option value="Paciente">Paciente</option>
        </select>
      
        <button class="btn" type="submit">Crear Cuenta</button>
      </form>
    </div>
    <div class="logo-section">
      <img src="assets/logo.png" alt="Droguedex" class="logo">
      <h1 class="logo-text">Droguedex</h1>
    </div>
  </div>

  <script>
    document.getElementById('registerForm').addEventListener('submit', async function (e) {
  e.preventDefault();

  // Captura de datos del formulario
  const nombre = document.getElementById('nombre').value.trim();
  const apellido = document.getElementById('apellido').value.trim();
  const correo = document.getElementById('correo').value.trim();
  const contraseña = document.getElementById('contraseña').value.trim();
  const id_rol = document.getElementById('id_rol').value;

  if (!nombre || !apellido || !correo || !contraseña || !id_rol) {
    Swal.fire('Error', 'Por favor, complete todos los campos.', 'warning');
    return;
  }

  const submitButton = this.querySelector('button[type="submit"]');
  submitButton.disabled = true;
  submitButton.textContent = 'Registrando...';

  try {
    // Opción 1: Enviar como FormData
    const formData = new FormData();
    formData.append('nombre', nombre);
    formData.append('apellido', apellido);
    formData.append('correo', correo);
    formData.append('contraseña', contraseña);
    formData.append('id_rol', id_rol);

    // Alternativa: Construir un objeto JSON
    const jsonData = {
      nombre,
      apellido,
      correo,
      contraseña,
      id_rol
    };

    const useJSON = false; // Cambia a true si el backend requiere JSON
    const options = {
      method: 'POST',
      headers: useJSON ? { 'Content-Type': 'application/json' } : undefined,
      body: useJSON ? JSON.stringify(jsonData) : formData
    };

    const response = await fetch('https://cienciadatos701.dcramirez.com/G2/api/auth/register/', options);
    const result = await response.json();

    if (response.ok) {
      Swal.fire('Éxito', result.message || 'Usuario registrado exitosamente.', 'success').then(() => {
        window.location.href = 'welcome.html';
      });
    } else {
      Swal.fire('Error', result.error || 'Ocurrió un error al registrar el usuario.', 'error');
    }
  } catch (error) {
    Swal.fire('Error de red', error.message, 'error');
  } finally {
    submitButton.disabled = false;
    submitButton.textContent = 'Crear Cuenta';
  }
});

  </script>
</body>
</html>
